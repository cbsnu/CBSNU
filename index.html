<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CBSN-U | Education & Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f0f2f5;
      color: #333;
    }
    header {
      background: #4b6cb7;
      background: linear-gradient(135deg, #4b6cb7, #182848);
      color: white;
      padding: 1rem 2rem;
      text-align: center;
    }
    nav a, .toggle-admin-btn {
      color: white;
      margin: 0 1rem;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
    }
    nav a:hover, .toggle-admin-btn:hover {
      text-decoration: underline;
    }
    section {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    footer {
      background: #182848;
      color: white;
      text-align: center;
      padding: 1rem;
      margin-top: 2rem;
    }
    .btn {
      display: inline-block;
      background: #4b6cb7;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      text-decoration: none;
      margin-top: 1rem;
    }
    .btn:hover {
      background: #3a5499;
    }

    /* Admin panel styles */
    #admin-panel-extended {
      display: none;
      max-width: 900px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      color: #333;
    }
    #admin-panel-extended h2, #admin-panel-extended h3 {
      color: #4a148c;
    }
    #admin-panel-extended input, #admin-panel-extended textarea {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
    }
    #admin-panel-extended button {
      padding: 0.6rem 1.2rem;
      background: #4a148c;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 0.3rem 0;
    }
    #admin-panel-extended button:hover {
      background: #6a1b9a;
    }
    #logout-btn {
      background: #c62828 !important;
      margin-bottom: 1rem;
    }
    .section {
      margin-bottom: 2rem;
    }
    .list-item {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem 0;
    }
    label {
      font-weight: bold;
    }

    /* Message styles */
    #message {
      margin-top: 1rem;
      height: 1.2rem;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  <h1>CBSN-U Education Platform</h1>
  <nav>
    <a href="#courses" onclick="showMainPage()">Courses</a>
    <a href="#faculty" onclick="showMainPage()">Faculty</a>
    <a href="#admissions" onclick="showMainPage()">Admissions</a>
    <span class="toggle-admin-btn" id="toggle-admin-btn" onclick="toggleAdminPanel()">Admin Panel</span>
  </nav>
</header>

<!-- Main Education Content -->
<div id="main-content">
  <section id="courses">
    <h2>Our Courses</h2>
    <p>We offer undergraduate, postgraduate, and certification courses designed to bridge borders and open global opportunities.</p>
    <ul>
      <li>Bachelor of Science in Computer Science</li>
      <li>Master of Business Administration</li>
      <li>Professional Certificate in Digital Marketing</li>
    </ul>
  </section>

  <section id="faculty">
    <h2>Meet Our Faculty</h2>
    <p>Experienced educators dedicated to delivering quality, accessible education.</p>
    <ul>
      <li><strong>Rittik Raj</strong> – Founder & CEO</li>
      <li><strong>Aarav Singh</strong> – Chief Technology Officer</li>
      <li><strong>Meera Das</strong> – Chief Operating Officer</li>
    </ul>
  </section>

  <section id="admissions">
    <h2>Admissions</h2>
    <p>Apply now to join CBSN-U and start your educational journey.</p>
    <a class="btn" href="admission.html">Apply Here</a>
  </section>
</div>

<!-- Admin Panel Extended -->
<div id="admin-panel-extended">
  <h2>Admin Panel</h2>
  <p>Welcome, <span id="user-email"></span></p>
  <button id="logout-btn">Logout</button>

  <div class="section">
    <h3>Login or Signup</h3>
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button id="login-btn">Login</button>
    <button id="signup-btn">Sign Up</button>
    <div class="message" id="message"></div>
  </div>

  <!-- Registered Users -->
  <div class="section">
    <h3>Registered Users</h3>
    <ul id="users-list"></ul>
  </div>

  <!-- Admission Forms -->
  <div class="section">
    <h3>Admission Forms</h3>
    <form id="admission-form">
      <label>Name:</label>
      <input type="text" id="admission-name" required />
      <label>Email:</label>
      <input type="email" id="admission-email" required />
      <label>Course Interested:</label>
      <input type="text" id="admission-course" required />
      <button type="submit">Add Admission</button>
    </form>
    <ul id="admission-list"></ul>
  </div>

  <!-- Reviews -->
  <div class="section">
    <h3>Reviews</h3>
    <form id="review-form">
      <label>Student Name:</label>
      <input type="text" id="review-name" required />
      <label>Review Text:</label>
      <textarea id="review-text" required></textarea>
      <button type="submit">Add Review</button>
    </form>
    <ul id="review-list"></ul>
  </div>

  <!-- Gallery Upload -->
  <div class="section">
    <h3>Gallery Upload</h3>
    <input type="file" id="gallery-file" accept="image/*" />
    <button id="upload-btn">Upload Image</button>
    <div id="gallery-list"></div>
  </div>
</div>

<footer>
  &copy; 2025 CBSN-U. All rights reserved.
</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // Firebase config here
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  // Elements
  const mainContent = document.getElementById('main-content');
  const adminPanel = document.getElementById('admin-panel-extended');
  const toggleAdminBtn = document.getElementById('toggle-admin-btn');
  const userEmailSpan = document.getElementById('user-email');
  const logoutBtn = document.getElementById('logout-btn');

  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginBtn = document.getElementById('login-btn');
  const signupBtn = document.getElementById('signup-btn');
  const messageDiv = document.getElementById('message');

  const usersList = document.getElementById('users-list');

  const admissionForm = document.getElementById('admission-form');
  const admissionList = document.getElementById('admission-list');
  const admissionName = document.getElementById('admission-name');
  const admissionEmail = document.getElementById('admission-email');
  const admissionCourse = document.getElementById('admission-course');

  const reviewForm = document.getElementById('review-form');
  const reviewList = document.getElementById('review-list');
  const reviewName = document.getElementById('review-name');
  const reviewText = document.getElementById('review-text');

  const galleryFileInput = document.getElementById('gallery-file');
  const uploadBtn = document.getElementById('upload-btn');
  const galleryList = document.getElementById('gallery-list');

  // Show message helper
  function showMessage(msg, color='red') {
    messageDiv.style.color = color;
    messageDiv.textContent = msg;
    setTimeout(() => { messageDiv.textContent = ''; }, 4000);
  }

  // Toggle Admin Panel visibility
  function toggleAdminPanel() {
    if (adminPanel.style.display === 'block') {
      adminPanel.style.display = 'none';
      mainContent.style.display = 'block';
      toggleAdminBtn.textContent = 'Admin Panel';
    } else {
      adminPanel.style.display = 'block';
      mainContent.style.display = 'none';
      toggleAdminBtn.textContent = 'Main Site';
    }
  }

  // Show main page content
  function showMainPage() {
    adminPanel.style.display = 'none';
    mainContent.style.display = 'block';
    toggleAdminBtn.textContent = 'Admin Panel';
  }

  // Signup user and add role 'user'
  signupBtn.addEventListener('click', () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) {
      showMessage('Enter email and password');
      return;
    }
    auth.createUserWithEmailAndPassword(email, password)
      .then(({ user }) => {
        return db.collection('users').doc(user.uid).set({
          email: user.email,
          role: 'user',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      })
      .then(() => {
        showMessage('Signup successful! Please login.', 'green');
        emailInput.value = '';
        passwordInput.value = '';
      })
      .catch(err => showMessage(err.message));
  });

  // Login user
  loginBtn.addEventListener('click', () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) {
      showMessage('Enter email and password');
      return;
    }
    auth.signInWithEmailAndPassword(email, password)
      .catch(err => showMessage(err.message));
  });

  // Logout user
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Monitor auth state
  auth.onAuthStateChanged(async user => {
    if (user) {
      const doc = await db.collection('users').doc(user.uid).get();
      if (!doc.exists) {
        showMessage('User data not found', 'red');
        auth.signOut();
        return;
      }
      const userData = doc.data();
      userEmailSpan.textContent = user.email;

      if (userData.role === 'admin') {
        // Show admin panel automatically when logged in as admin
        adminPanel.style.display = 'block';
        mainContent.style.display = 'none';
        toggleAdminBtn.textContent = 'Main Site';

        loadUsers();
        loadAdmissions();
        loadReviews();
        loadGallery();
      } else {
        showMessage('Logged in as user: ' + user.email, 'green');
        adminPanel.style.display = 'none';
        mainContent.style.display = 'block';
        toggleAdminBtn.textContent = 'Admin Panel';
      }
    } else {
      // No user logged in
      userEmailSpan.textContent = '';
      adminPanel.style.display = 'none';
      mainContent.style.display = 'block';
      toggleAdminBtn.textContent = 'Admin Panel';
    }
  });

  // Load users
  function loadUsers() {
    usersList.innerHTML = '<li>Loading users...</li>';
    db.collection('users').get().then(snapshot => {
      usersList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement('li');
        li.classList.add('list-item');
        li.textContent = `${data.email} — Role: ${data.role}`;
        usersList.appendChild(li);
      });
    }).catch(err => {
      usersList.innerHTML = `<li>Error loading users: ${err.message}</li>`;
    });
  }

  // Admission forms
  admissionForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = admissionName.value.trim();
    const email = admissionEmail.value.trim();
    const course = admissionCourse.value.trim();
    if (!name || !email || !course) {
      alert("Please fill all admission fields.");
      return;
    }
    db.collection("admissions")
      .add({
        name,
        email,
        course,
        submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
      })
      .then(() => {
        admissionName.value = "";
        admissionEmail.value = "";
        admissionCourse.value = "";
        loadAdmissions();
        alert("Admission form added.");
      })
      .catch((err) => alert("Error adding admission: " + err.message));
  });

// Load admission forms
function loadAdmissions() {
  admissionList.innerHTML = "<li>Loading admissions...</li>";
  db.collection("admissions")
    .orderBy("submittedAt", "desc")
    .get()
    .then((snapshot) => {
      admissionList.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const li = document.createElement("li");
        li.classList.add("list-item");
        li.textContent = `${data.name} (${data.email}) - Interested in: ${data.course}`;
        admissionList.appendChild(li);
      });
    })
    .catch((err) => {
      admissionList.innerHTML = `<li>Error loading admissions: ${err.message}</li>`;
    });
}

// Reviews form submit handler
reviewForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const name = reviewName.value.trim();
  const text = reviewText.value.trim();
  if (!name || !text) {
    alert("Please fill all review fields.");
    return;
  }
  db.collection("reviews")
    .add({
      name,
      text,
      submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
    })
    .then(() => {
      reviewName.value = "";
      reviewText.value = "";
      loadReviews();
      alert("Review added.");
    })
    .catch((err) => alert("Error adding review: " + err.message));
});

// Load reviews
function loadReviews() {
  reviewList.innerHTML = "<li>Loading reviews...</li>";
  db.collection("reviews")
    .orderBy("submittedAt", "desc")
    .get()
    .then((snapshot) => {
      reviewList.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const li = document.createElement("li");
        li.classList.add("list-item");
        li.innerHTML = `<strong>${data.name}:</strong> ${data.text}`;
        reviewList.appendChild(li);
      });
    })
    .catch((err) => {
      reviewList.innerHTML = `<li>Error loading reviews: ${err.message}</li>`;
    });
}

// Gallery upload handler
uploadBtn.addEventListener("click", () => {
  const file = galleryFileInput.files[0];
  if (!file) {
    alert("Please select an image to upload.");
    return;
  }
  const storageRef = storage.ref("gallery/" + file.name);
  const uploadTask = storageRef.put(file);

  uploadTask.on(
    "state_changed",
    null,
    (error) => {
      alert("Upload failed: " + error.message);
    },
    () => {
      uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
        db.collection("gallery")
          .add({
            url: downloadURL,
            name: file.name,
            uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
          })
          .then(() => {
            alert("Image uploaded!");
            galleryFileInput.value = "";
            loadGallery();
          });
      });
    }
  );
});

// Load gallery images
function loadGallery() {
  galleryList.innerHTML = "Loading gallery...";
  db.collection("gallery")
    .orderBy("uploadedAt", "desc")
    .get()
    .then((snapshot) => {
      galleryList.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const img = document.createElement("img");
        img.src = data.url;
        img.alt = data.name;
        img.style = "max-width: 150px; margin: 5px; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.15)";
        galleryList.appendChild(img);
      });
    })
    .catch((err) => {
      galleryList.innerHTML = `Error loading gallery: ${err.message}`;
    });
}
</script>

</body>
</html>
